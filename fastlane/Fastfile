default_platform(:ios)

platform :ios do
  desc "Build and sign the app"
  lane :build do
    match(
      type: "appstore",
      readonly: true, # Ensure this is true to prevent creating a new certificate
      generate_apple_certs: false, # Ensure this is false to avoid generating new certificates
      force_for_new_certificates: false, # Ensure this is false to avoid forcing new certificates
      skip_provisioning_profiles: false
    )
    gym(
      scheme: "App",
      export_method: "app-store",
      export_options: {
        compileBitcode: false,
        method: "app-store"
      }
    )
  end

  desc "Deploy the app"
  lane :deploy do
    build_app(
      workspace: "App.xcworkspace",
      scheme: "App",
      export_method: "app-store",
      output_directory: "./build"
    )
    upload_to_app_store
  end
end