default_platform(:ios)

platform :ios do
  desc "Build and sign the app"
  lane :build do
    match(
      type: "appstore",
      readonly: true, # Ensure this is true to avoid creating new certificates
      generate_apple_certs: false, # Ensure this is false to avoid generating new certificates
    )
    gym(
      workspace: "App.xcworkspace", # Specify the workspace or project file
      scheme: "App",
      export_method: "app-store",
      export_options: {
        compileBitcode: false,
        method: "app-store"
      }
    )
  end

  desc "Deploy the app"
  lane :deploy do
    build_app(
      workspace: "App.xcworkspace", # Specify the workspace or project file
      scheme: "App",
      export_method: "app-store",
      output_directory: "./build"
    )
    upload_to_app_store
  end
end
